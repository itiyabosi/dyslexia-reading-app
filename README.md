# ディスレクシア児童 音韻認識テストアプリ

ディスレクシア児童の音韻認識の発達を分析するために作られた、単語読み上げテストアプリケーションです。

## 機能

### 1. 児童管理
- 児童の基本情報（名前、学年、生年月日、備考）を登録・管理
- 児童ごとのテスト実施状況を追跡

### 2. 単語リスト管理
- 複数の単語リストを作成・管理
- 各リストに任意の単語を追加・削除
- **PDF・Word文書インポート**: PDF、Word文書（.docx, .doc）から単語を自動抽出して一括追加
  - 改行・スペースで区切られた単語を自動認識
  - ひらがな、カタカナ、漢字、英数字に対応
- サンプルとして「基本単語セット1」が自動作成されます

### 3. フォント管理
- **UDフォント対応**: ディスレクシア児童向けのユニバーサルデザインフォントを10種類搭載
  - BIZ UDPゴシック、BIZ UDP明朝
  - OpenDyslexic（ディスレクシア特化フォント）
  - Lexend（可読性向上フォント）
  - UDデジタル教科書体、游ゴシック、メイリオ など
- **カスタムフォントアップロード**: ローカルから.ttf、.otf、.woff、.woff2形式のフォントファイルを追加可能
- テスト時にフォントをリアルタイムで切り替え可能

### 4. 読み上げテスト
- 選択した児童に対して、指定した単語リストでテストを実施
- **タイマー機能**: スタートボタンで単語表示＋計測開始、ストップボタンで計測終了
- **キーボードショートカット**:
  - スペースキー: スタート/ストップの切り替え
  - Enterキー: 結果記録と次の単語へ進む
- 各単語について以下を記録：
  - 読めたか／読めなかったか
  - 読み上げにかかった秒数（ミリ秒単位）
  - 読み間違えた場合の内容
  - 備考
  - 使用したフォント

### 5. データ分析
- 児童別の詳細統計表示：
  - テスト実施回数、読めた単語数
  - 平均読み時間、最速・最遅時間
  - 読み間違い回数、正答率
  - テスト実施日数
- **可視化グラフ**:
  - 成績推移グラフ（時系列）
  - 読み時間の推移
  - 正答率の内訳（円グラフ）
  - 単語リスト別成績（棒グラフ）
- テスト履歴の詳細表示（日時、単語、結果、読み時間など）
- 印刷・PDF保存機能

## データベース構造

### テーブル一覧

1. **children（児童マスター）**
   - id, name, grade, birth_date, notes, created_at

2. **word_lists（単語リスト）**
   - id, name, description, created_at

3. **words（単語）**
   - id, word_list_id, word_text, display_order

4. **fonts（フォント管理）**
   - id, name, font_family, font_type（webfont/system/custom）, file_path, is_active, created_at

5. **reading_records（読み上げテスト記録）**
   - id, child_id, word_id, test_date, could_read, reading_time_seconds, misread_as, notes, font_id

すべてのデータは SQLite データベース（reading_data.db）に保存されます。

## インストール方法

### 必要な環境
- Node.js（バージョン 14 以上推奨）
- npm

### セットアップ手順

1. プロジェクトディレクトリに移動
```bash
cd dyslexia-reading-app
```

2. 依存パッケージのインストール
```bash
npm install
```

3. アプリケーションの起動
```bash
npm start
```

4. ブラウザで以下のURLにアクセス
```
http://localhost:3001
```

## 使い方

### 1. 児童の登録
1. ホーム画面で児童情報を入力して「登録」ボタンをクリック

### 2. フォントの設定（オプション）
1. 「フォント管理」ページに移動
2. 必要に応じてカスタムフォントをアップロード
   - .ttf、.otf、.woff、.woff2形式に対応
3. デフォルトで10種類のUDフォントが利用可能

### 3. 単語リストの作成
1. 「単語リスト管理」ページに移動
2. 新しいリストを作成
3. 単語を追加（以下のいずれか）：
   - **手動入力**: 単語を1つずつ入力して追加
   - **文書インポート**: PDF・Word文書から単語を一括インポート
     - ファイルを選択してアップロード
     - 自動的に単語が抽出され、リストに追加されます

### 4. テストの実施
1. ホーム画面で「テスト開始」ボタンをクリック
2. 使用する単語リストを選択
3. フォントを選択（ドロップダウンから選択可能）
4. 各単語について：
   - **スペースキー**または「スタート」ボタンをクリック → 単語が表示され、タイマーが開始
   - 児童が単語を読む
   - 読み終わったら**スペースキー**または「ストップ」ボタンをクリック
   - 結果を記録（読めた／読めなかった、読み間違いなど）
   - **Enterキー**または「記録して次へ」をクリック
5. 全単語終了後、テスト完了画面が表示されます

### 5. データの確認
1. 「データ分析」ページに移動
2. 児童を選択して統計とテスト履歴を確認
3. 印刷ボタンでPDFとして保存可能

## 技術スタック

- **バックエンド**: Node.js + Express v5.1.0
- **データベース**: SQLite (better-sqlite3)
- **テンプレートエンジン**: EJS
- **フロントエンド**: HTML/CSS/JavaScript（Vanilla JS）
- **グラフ描画**: Chart.js v4.4.0
- **ファイルアップロード**: Multer
- **文書解析**:
  - PDF: pdf-parse
  - Word: mammoth
- **Webフォント**: Google Fonts、jsDelivr CDN

## ファイル構成

```
dyslexia-reading-app/
├── server.js              # Expressサーバー
├── database.js            # データベース初期化とスキーマ定義
├── package.json           # プロジェクト設定
├── reading_data.db        # SQLiteデータベース（自動生成）
├── .gitignore             # Git除外設定
├── .env.example           # 環境変数のサンプル
├── .claude/
│   └── project.md         # プロジェクトドキュメント
├── public/
│   ├── css/
│   │   └── style.css      # スタイルシート
│   └── fonts/             # カスタムフォント（アップロード先、Gitで除外）
├── uploads/               # 一時ファイル保存先（Gitで除外）
└── views/
    ├── index.ejs          # ホーム画面（児童管理）
    ├── word-lists.ejs     # 単語リスト一覧
    ├── word-list-detail.ejs # 単語リスト詳細・編集
    ├── fonts.ejs          # フォント管理画面
    ├── test.ejs           # 読み上げテスト画面
    └── analysis.ejs       # データ分析画面
```

## 注意事項

- データベースファイル（reading_data.db）は自動的に作成されます
- サンプルデータとして「基本単語セット1」が初回起動時に自動作成されます
- 児童を削除すると、その児童のすべてのテスト記録も削除されます
- 単語リストを削除すると、その中の単語とテスト記録も削除されます

## ライセンス

ISC
